# Документ требований

## Введение

Эта функция обеспечивает кросс-платформенную дистрибуцию CLI инструмента `aa` через несколько методов установки. Пользователи смогут устанавливать `aa` через Homebrew на macOS, curl-установщик на Linux/macOS/Windows, или как запасной вариант через менеджеры пакетов Python. Система будет автоматически собирать платформо-специфичные бинарники используя PyInstaller и публиковать их в GitHub Releases.

## Глоссарий

- **CLI Инструмент**: Консольное приложение `aa` для управления ID задач в Asana
- **Бинарник**: Автономный исполняемый файл, который не требует установленного Python
- **GitHub Actions**: Автоматизированный CI/CD workflow, который выполняется на инфраструктуре GitHub
- **GitHub Releases**: Функция GitHub для публикации версионированных релизов с загружаемыми файлами
- **PyInstaller**: Инструмент, который упаковывает Python приложения в автономные исполняемые файлы
- **Homebrew**: Менеджер пакетов для macOS и Linux
- **Homebrew Tap**: Сторонний репозиторий формул Homebrew
- **Homebrew Formula**: Ruby скрипт, который определяет как установить пакет
- **release-lab/install**: Универсальный установочный скрипт для загрузки бинарников из GitHub Releases
- **Asset**: Файл, прикрепленный к GitHub Release (например, бинарник, архив)
- **Tag**: Git ссылка, отмечающая конкретную точку в истории репозитория, обычно используется для релизов
- **Artifact**: Файл, созданный в процессе сборки
- **Matrix Build**: Стратегия GitHub Actions, которая запускает задачи на нескольких операционных системах и конфигурациях

## Requirements

### Требование 1

**Пользовательская история:** Как пользователь macOS, я хочу установить aa через Homebrew, чтобы легко управлять инструментом вместе с другими пакетами.

#### Критерии приемки

1. WHEN пользователь выполняет `brew tap umaxfun/aa` THEN Система SHALL добавить кастомный tap репозиторий в Homebrew
2. WHEN пользователь выполняет `brew install aa` после добавления tap THEN Система SHALL скачать и установить бинарник aa для платформы пользователя
3. WHEN установка завершается THEN Система SHALL сделать команду `aa` доступной в PATH пользователя
4. WHEN пользователь выполняет `brew upgrade aa` THEN Система SHALL обновить до последней версии если доступна
5. WHERE пользователь на macOS THEN Система SHALL поддерживать обе архитектуры Intel (x86_64) и Apple Silicon (arm64)

### Требование 2

**Пользовательская история:** Как пользователь Linux или Windows, я хочу установить aa через curl команду, чтобы быстро настроить инструмент без ручных загрузок.

#### Критерии приемки

1. WHEN пользователь выполняет curl команду установки THEN Система SHALL автоматически определить операционную систему
2. WHEN операционная система определена THEN Система SHALL автоматически определить архитектуру CPU
3. WHEN OS и архитектура определены THEN Система SHALL скачать соответствующий бинарник из GitHub Releases
4. WHEN бинарник скачан THEN Система SHALL распаковать его в стандартное расположение
5. WHEN распаковка завершена THEN Система SHALL сделать команду `aa` доступной в PATH пользователя
6. WHERE платформа Linux THEN Система SHALL поддерживать архитектуры x86_64 и arm64
7. WHERE платформа Windows THEN Система SHALL поддерживать архитектуру x86_64

### Требование 3

**Пользовательская история:** Как разработчик, я хочу чтобы бинарники автоматически собирались при создании release тега, чтобы не компилировать вручную для каждой платформы.

#### Критерии приемки

1. WHEN разработчик пушит тег соответствующий паттерну `v*` THEN Система SHALL запустить workflow сборки
2. WHEN workflow сборки запускается THEN Система SHALL собрать бинарники для Linux x86_64, Linux arm64, macOS x86_64, macOS arm64 и Windows x86_64
3. WHEN каждый бинарник собран THEN Система SHALL упаковать его в сжатый архив с форматом имени `aa-{version}-{os}-{arch}.tar.gz` для Linux и macOS, и `aa-{version}-{os}-{arch}.zip` для Windows
4. WHEN все бинарники собраны THEN Система SHALL создать GitHub Release с версией тега
5. WHEN GitHub Release создан THEN Система SHALL загрузить все архивы бинарников как release assets
6. IF любая сборка падает THEN Система SHALL сообщить об ошибке и остановить процесс релиза

### Требование 4

**Пользовательская история:** Как пользователь, я хочу чтобы установленный бинарник работал автономно, чтобы не нужно было устанавливать Python или управлять зависимостями.

#### Критерии приемки

1. WHEN PyInstaller упаковывает приложение THEN Система SHALL включить интерпретатор Python в бинарник
2. WHEN PyInstaller упаковывает приложение THEN Система SHALL включить все Python зависимости в бинарник
3. WHEN пользователь запускает бинарник THEN Система SHALL выполняться без требования установленного Python в системе
4. WHEN бинарник запускается THEN Система SHALL функционировать идентично запуску через `uv run aa`
5. WHEN бинарник выполняется THEN Система SHALL извлекать временные файлы в директорию кеша только если необходимо

### Требование 5

**Пользовательская история:** Как мейнтейнер, я хочу чтобы Homebrew formula автоматически ссылалась на правильные URL бинарников, чтобы пользователи всегда получали правильную версию.

#### Критерии приемки

1. WHEN новый релиз опубликован THEN Homebrew Formula SHALL ссылаться на URL бинарников из этого релиза
2. WHEN formula оценивается THEN Система SHALL выбрать бинарник соответствующий операционной системе пользователя
3. WHEN formula оценивается THEN Система SHALL выбрать бинарник соответствующий архитектуре CPU пользователя
4. WHEN бинарник скачивается THEN Система SHALL проверить загрузку используя SHA256 checksums
5. WHEN проверка checksum падает THEN Система SHALL прервать установку и сообщить об ошибке

### Требование 6

**Пользовательская история:** Как пользователь, я хочу четкие инструкции по установке в README, чтобы быстро понять как установить инструмент на моей платформе.

#### Критерии приемки

1. WHEN пользователь просматривает README THEN Система SHALL отображать инструкции по установке для Homebrew
2. WHEN пользователь просматривает README THEN Система SHALL отображать инструкции по установке через curl
3. WHEN пользователь просматривает README THEN Система SHALL отображать запасные инструкции по установке используя pipx или uvx
4. WHEN инструкции по установке показаны THEN Система SHALL организовать их по операционным системам
5. WHEN инструкции по установке показаны THEN Система SHALL включить примеры команд которые можно скопировать напрямую

### Требование 7

**Пользовательская история:** Как разработчик, я хочу чтобы конфигурация PyInstaller была под версионным контролем, чтобы сборки были воспроизводимыми и консистентными.

#### Критерии приемки

1. WHEN репозиторий содержит PyInstaller spec файл THEN Система SHALL использовать его для всех сборок
2. WHEN spec файл оценивается THEN Система SHALL настроить имя бинарника как `aa`
3. WHEN spec файл оценивается THEN Система SHALL настроить режим вывода в один файл
4. WHEN spec файл оценивается THEN Система SHALL включить все необходимые файлы данных и зависимости
5. WHEN spec файл оценивается THEN Система SHALL исключить ненужные файлы для минимизации размера бинарника

### Требование 8

**Пользовательская история:** Как пользователь на неподдерживаемой платформе, я хочу запасной метод установки, чтобы все равно использовать инструмент даже если бинарники недоступны.

#### Критерии приемки

1. WHEN установка бинарника недоступна THEN Документация SHALL предоставить инструкции для установки через pipx
2. WHEN установка бинарника недоступна THEN Документация SHALL предоставить инструкции для установки через uvx
3. WHEN пользователь устанавливает через pipx THEN Система SHALL установить из PyPI
4. WHEN пользователь устанавливает через uvx THEN Система SHALL установить из PyPI
5. WHEN установлено через менеджеры пакетов Python THEN Система SHALL функционировать идентично версии бинарника


### Требование 11

**Пользовательская история:** Как разработчик, я хочу чтобы формат архивов соответствовал ожиданиям установочных скриптов, чтобы установка работала корректно на всех платформах.

#### Критерии приемки

1. WHEN система собирает бинарники для Linux THEN Архивы SHALL использовать формат `.tar.gz`
2. WHEN система собирает бинарники для macOS THEN Архивы SHALL использовать формат `.tar.gz`
3. WHEN система собирает бинарники для Windows THEN Архивы SHALL использовать формат `.zip`
4. WHEN архив распаковывается THEN Бинарник SHALL находиться в корне архива без дополнительных вложенных папок
5. WHEN release-lab/install скрипт скачивает архив THEN Формат имени файла SHALL соответствовать паттерну который скрипт может распознать
